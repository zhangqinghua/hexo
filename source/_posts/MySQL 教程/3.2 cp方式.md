---
title: 3.2 cp方式

categories:
- MySQL教程

date: 2020-03-09 00:00:02
---

## 使用cp进行备份
#### 向数据表施加读锁（只能读不能写）
```bash
mysql> flush tables with read lock;
```

#### 备份数据文件
```bash
zhangqinghua$ mkdir /backup                     # 创建文件夹存放备份数据库文件
zhangqinghua$ cp -a /var/lib/mysql/* /backup    # 保留权限的拷贝源数据文件
```

#### 释放锁
```bash
mysql> unlock tables;
```

#### 模拟数据丢失并恢复
```bash
# 随便删除一条数据
zhangqinghua$ systemctl stop mysqld             # 先停止MySQL服务
zhangqinghua$ rm -rf /var/lib/mysql/*           # 清空数据，这一步可以不做
zhangqinghua$ cp -a /backup/* /var/lib/mysql/   # 将备份的数据文件拷贝回去
zhangqinghua$ systemctl start mysqld            # 重启MySQL服务
# 可以看到，数据又回来了
```

## 使用mysqldump备份数据
mysqldump是MySQL自带的逻辑备份工具。它的原理是，通过协议连接到MySQL数据库，将需要备份的数据查询出来转化成对应的insert语句，当我们需要还原这些数据时，只要执行这些insert语句即可。

```bash
zhangqinghua$ mysql -uroot -p -e 'show master status'
Enter password: 
+---------------+----------+--------------+------------------+-------------------+
| File          | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
+---------------+----------+--------------+------------------+-------------------+
| binlog.000002 |      584 |              |                  |                   |
+---------------+----------+--------------+------------------+-------------------+
```