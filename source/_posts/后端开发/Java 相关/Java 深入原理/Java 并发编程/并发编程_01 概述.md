---
title: 并发编程_01 概述

categories: 
- 后端开发
- Java 并发编程

date: 2020-07-01 00:00:01
---
并发编程是整个 Java 开发体系中最难以理解，但也是最重要的知识点之一，因此学习起来比较费劲，从而导致很多人望而却步，但是无论是职场面试还是高并发高流量的系统的实现都离不开并发编程，能够真正掌握并发编程的人才在市场上供不应求。

## 线程与进程
1. 定义上
    进程是一个在内存中运行的应用程序，线程是进程的一个执行任务（单元）,一个进程可以拥有多个线程。
1. 内存分配
    进程之间的地址空间和资源是相互独立的，同一进程的线程共享本进程的地址空间和资源。
1. 执行过程
    每个独立的进程有程序运行的入口、顺序执行序列和程序出口。但是线程不能独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制，两者均可并发执行。
1. 影响关系
    一个进程崩溃后，在保护模式下不会对其他进程产生影响，但是一个线程崩溃整个进程都死掉。所以多进程要比多线程健壮。

## 并行与并发
串行是指有 n 个任务由一个线程按顺序执行。由于任务、方法都在一个线程执行所以不存在线程不安全情况，也就不存在临界区的问题。

并发是指多个任务在同一个 CPU 核上，按细分的时间片轮流（交替）执行，从逻辑上来看那些任务是同时执行。

并行是指单位时间内，多个处理器或多核处理器同时处理多个任务，是真正意义上的“同时进行”。

做一个形象的比喻：
1. 串行：一个队列和一台咖啡机。
1. 并发：两个队列和一台咖啡机。
1. 并行：两个队列和两台咖啡机。

## 上下文切换
多线程编程中一般线程的个数都大于 CPU 核心的个数，而一个 CPU 核心在任意时刻只能被一个线程使用，为了让这些线程都能得到有效执行，CPU 采取的策略是为每个线程分配时间片并轮转的形式。当一个线程的时间片用完的时候就会重新处于就绪状态让给其他线程使用，这个过程就属于一次上下文切换。

概括来说就是：当前任务在执行完 CPU 时间片切换到另一个任务之前会先保存自己的状态，以便下次再切换回这个任务时，可以再加载这个任务的状态。任务从保存到再加载的过程就是一次上下文切换。

上下文切换通常是计算密集型的。也就是说，它需要相当可观的处理器时间，在每秒几十上百次的切换中，每次切换都需要纳秒量级的时间。所以，上下文切换对系统来说意味着消耗大量的 CPU 时间，事实上，可能是操作系统中时间消耗最大的操作。

在 8 核主机上对上下文切换时间的测试：

|线程数|睡眠 500ms 耗时|复杂任务耗时|
| :- |
|1|501ms|700ms|
|8|501ms|257ms|
|80|509ms|180ms|
|800|554ms|223ms|
|8000|2508ms|675ms|

> 每次线程切换开销大约是 3.8us 左右。从上下文切换的耗时上来看，Linux 线程（轻量级进程）其实和进程差别不太大。

#### Java 内存中哪些数据是线程安全的，哪些是非安全的？
1. 线程安全：局部变量、方法定义的参数、异常处理器参数是当前线程的虚拟机栈中的数据,并且不会进行线程共享,所以不会存在内存可见性问题；
1. 非线程安全：所有的实例域、静态域、和数组元素都存放在堆内存中，并且这些数据是线程共享的，所以会存在内存可见性问题；


## 问题
1. 线程与进程的区别
1. 串行、并发与并行的区别


1. 什么是线程

1. 什么是守护进程
1. 什么是用户线程

1. 什么是多线程
1. 什么是并发编程
1. 什么是上下文切换
1. 并行和并发的区别

1. 如何查看线程 CPU 使用率

1. 并发编程是什么
1. 并发编程有什么优缺点

什么是线程死锁

形成死锁的必要条件是什么

如何避免死锁

## 线程基础
创建线程有哪几种方式

runnable 和 callable 有什么区别

run 和 start 有什么区别

为什么调用 start() 会执行 run()

为什么不能直接调用 run()。

1. 如何停止一个正在运行的线程？

## 线程状态
1. 说说线程的生命周期
1. 说说线程有哪些状态
1. 说说线程的调度算法
1. 什么是线程调度器
1. 什么是时间分片
1. 线程同步的相关方法
1. 线程调度的相关方法

1. sleep() 和 wait() 有什么区别
1. 你是如何调用 wait() 方法的？使用 if 块还是循环？为什么？
1. 为什么线程通信的方法 wait(), notify()和 notifyAll()被定义在 Object 类里？
1. 为什么 wait(), notify()和 notifyAll()必须在同步方法或者同步块中被调用？
1. Thread 类中的 yield() 有什么作用？
1. 为什么 Thread 类的 sleep()和 yield ()方法是静态的？
1. 线程的 sleep()方法和 yield()方法有什么区别？
1. Java 中 interrupted 和 isInterrupted 方法的区别？
1. 什么是阻塞式方法？
1. Java 中你怎样唤醒一个阻塞的线程？
1. notify() 和 notifyAll() 有什么区别？
1. 如何在两个线程间共享数据？
Java 如何实现多线程之间的通讯和协作？
同步方法和同步块，哪个是更好的选择？
什么是线程同步和线程互斥，有哪几种实现方式？
在监视器(Monitor)内部，是如何做线程同步的？程序应该做哪种级别的同步？
如果你提交任务时，线程池队列已满，这时会发生什么
什么叫线程安全？servlet 是线程安全吗?
在 Java 程序中怎么保证多线程的运行安全？
你对线程优先级的理解是什么？
线程类的构造方法、静态块是被哪个线程调用的
Java 中怎么获取一份线程 dump 文件？你如何在 Java 中获取线程堆栈？
一个线程运行时发生异常会怎样？
Java 线程数过多会造成什么异常？

## 异步编程
1. Callable 是什么
1. Future 是什么
1. FutureTask 是什么

## 线程池

## 并发编程
finalize()方法什么时候被调用？析构函数(finalization)的目的是什么？

为什么代码会重排序？

synchronized 的作用？

说说自己是怎么使用 synchronized 关键字，在项目中用到了吗

说一下 synchronized 底层实现原理？

什么是自旋

多线程中 synchronized 锁升级的原理是什么？

线程 B 怎么知道线程 A 修改了变量

当一个线程进入一个对象的 synchronized 方法 A 之后，其它线程是否可进入此对象的 synchronized 方法 B？

synchronized、volatile、CAS 比较
synchronized 和 Lock 有什么区别？
synchronized 和 ReentrantLock 区别是什么？

## volatile
volatile 关键字的作用
Java 中能创建 volatile 数组吗？
volatile 变量和 atomic 变量有什么不同？
volatile 能使得一个非原子操作变成原子操作吗？
volatile 修饰符的有过什么实践？
synchronized 和 volatile 的区别是什么？

## final
什么是不可变对象，它对写并发应用有什么帮助？

## Lock
Java Concurrency API 中的 Lock 接口(Lock interface)是什么？对比同步它有什么优势？
乐观锁和悲观锁的理解及如何实现，有哪些实现方式？
什么是 CAS
CAS 的会产生什么问题？
什么是死锁？
产生死锁的条件是什么？怎么防止死锁？
死锁与活锁的区别，死锁与饥饿的区别？
多线程锁的升级原理是什么？

## AQS


https://blog.csdn.net/ThinkWon/article/details/104863992


#### 附：线程安全性获取保证
工作内存与主内存同步延迟现象导致的可见性问题，可以使用 `synchronized` 或 `volatile` 关键字经济，它们都可以使一个线程修改后的变量立即对其它线程可见。

对于指令重排导致的可见性问题和有序性问题，可以利用 `volatile` 关键字解决，因为 `volatile` 的另外一个作用是禁止重排序优化。

对于原子性问题，可以使用 `sychronized` 或 `AtommicInteger` 解决。 