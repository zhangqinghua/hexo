---
title: 分布式事务 场景测试

categories:
- 后端开发
- 分布式事务

date: 2021-03-16 00:00:01
---
## 场景一 没有事务
#### 不进行查询数据库

#### 查询数据库

#### 修改数据库成功

#### 修改数据库失败

## 场景二 本地事务
测试在单个服务内的事务表现。

#### 正常流程
1. 单服务内没有异常能正常提交；
1. 单服务内执行事务时间为本地事务时间（10ms）；

#### 异常流程
1. 单服务内出现异常能正常回滚；
1. 单服务内执行事务时间为本地事务时间（10ms）；

## 场景二
测试在两个服务之间的分布式事务表现。

#### 正常流程
1. 订单服务正常创建订单；
1. 库存服务正常扣件库存；

#### 异常流程
1. 订单服务正常创建订单；
1. 库存服务正常扣件库存；
1. 订单服务抛出异常；
1. 库存服务回滚数据；

## 场景三
测试在两个服务之间的分布式事务表现。

#### 正常流程
1. 订单服务正常创建订单；
1. 库存服务正常扣件库存；
1. 库存服务查询订单服务刚刚创建的订单；

## 场景四：

## 性能对比
无业务场景：

```java
@ApiOperation("t0101")
@GetMapping("/t0101")
public BaseData<String> t0101() throws InterruptedException {
   return getBaseData("success");
}
```

|事务|并发|
| :- |
|无事务|25000|
|本地事务|1000|