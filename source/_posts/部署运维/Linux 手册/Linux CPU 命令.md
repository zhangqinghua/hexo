---
title: Linux CPU 命令

categories:
- 部署运维
- Linux 手册

date: 2021-04-08 00:00:58
---
#### vmstat 查看 CPU 概要
`vmstat` 用户查看 CPU 信息（包括但不限于），一般 `vmstat` 的使用是通过两个数字参数来完成，第一个参数是采样的时间间隔（s），第二个参数是采样的次数。

```bash
# r   运行和等待CPU时间片的进程数，原则上整个系统的运行队列不能超过总核数的2倍，否则代表系统压力过大
# b   等待资源的进程数，比如正在等待磁盘I/O，网络I/O等
# us  用户进程消耗CPU时间百分比，us值高，用户进程消耗CPU时间多。如果长期大于50%，优化程序
# sy  内核进程消耗的CPU时间百分比。us + sy 参考值为80%，如果大于，说明存在CPU不足

[root@iZwz9cp52a5yqx9b86ehecZ ~]# vmstat -n 2 3
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache    si   so    bi    bo   in   cs us sy id wa st
 1  0      0 143396  72548 1372116    0    0     0    15    8    3  1  0 99  0  0
 0  0      0 141380  72556 1372156    0    0     0    22 2964 3377  1  1 99  0  0
 0  0      0 142652  72556 1372164    0    0     0    82 2905 3296  0  0 99  0  0
```

#### mpstat 查看 CPU 明细
`mpstat` 用于查看所有的CPU信息。

```bash
# ALL          查询所有CPU信息
# 2            每隔2秒采样一次
[root@izwz98nlvwu8fv5c0warnfz ~]# mpstat -P ALL 2
Linux 3.10.0-693.2.2.el7.x86_64 (izwz98nlvwu8fv5c0warnfz)       01/22/2021      _x86_64_        (4 CPU)

11:58:09 AM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
11:58:11 AM  all    0.13    0.00    0.13    0.00    0.00    0.00    0.00    0.00    0.00   99.75
11:58:11 AM    0    0.00    0.00    0.50    0.00    0.00    0.00    0.00    0.00    0.00   99.50
11:58:11 AM    1    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
11:58:11 AM    2    0.50    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00   99.50
11:58:11 AM    3    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00

11:58:11 AM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
11:58:13 AM  all    0.38    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00   99.62
11:58:13 AM    0    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
11:58:13 AM    1    0.50    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00   99.50
11:58:13 AM    2    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
11:58:13 AM    3    1.01    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00   98.99
```

#### pidstat 查看进程的 CPU 占用
`pidstat` 用于查看每个进程使用 CPU 和内存的用量分解信息。

```bash
# -u 2         每个2秒采样一次
# -p 1282167   进程Id

[root@iZj6ci1r3ycwolsv7h3gbiZ ~]# pidstat -u 2 -p 1282167 
Linux 4.18.0-193.28.1.el8_2.x86_64 (iZj6ci1r3ycwolsv7h3gbiZ)    01/22/2021      _x86_64_        (4 CPU)

12:01:53 PM   UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command
12:01:55 PM     0   1282167    0.50    0.00    0.00    0.00    0.50     3  java
12:01:57 PM     0   1282167    0.50    0.00    0.00    0.00    0.50     3  java
12:01:59 PM     0   1282167    4.50    0.50    0.00    0.00    5.00     3  java
```