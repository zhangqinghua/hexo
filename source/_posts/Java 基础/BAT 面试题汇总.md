---
title: BAT 面试题汇总

categories:
- Java 基础

date: 2020-10-29
---

## Java 基础

## Java 进阶

## Java 网络
**输入 ping IP 后敲回车，发包前会发生什么？**
1. ping目标ip时，先查路由表，确定出接口
1. 如果落在直连接口子网内，此时若为以太网等 多路访问网络 则先查询arp缓存，命中则直接发出，否则在该接口上发arp询问目标ip的mac地址，取得后发出，若为ppp等 点对点网络 ，则直接可以发出；
1. 如果查表落在缺省路由上，此时若为以太网等 多路访问网络 则先查询网关arp缓存，命中则直接发出，否则在该接口上发arp询问网关的mac地址，取得后发出，若为ppp等 点对点网络 ，则直接可以发出；
1. 若查表未命中，则返回不可达。

## Java 虚拟机

## Java 多线程
**epoll 和 select 的区别？**
1. epoll 和 select 都是 I/O 多路复用的技术，都可以实现同时监听多个 I/O 事件的状态。
1. epoll 比 select 效率更高，主要是基于其操作系统支持的 I/O 事件通知机制，而 select 是基于轮询机制。
1. epoll 支持水平触发和边沿触发两种模式。

**那在高并发的访问下，epoll 使用那一种触发方式要高效些？当使用边缘触发的时候要注意些什么东西？**


**请解释下为什么鹿晗发布恋情的时候，微博系统会崩溃，如何解决？**
1. 获取微博通过 pull 方式还是 push 方式
1. 发布微博的频率要远小于阅读微博
1. 流量明星的发微博，和普通博主要区分对待，比如在 sharding 的时候，也要考虑这个因素



## MySQL

#### 索引
1. 从innodb的索引结构分析，为什么索引的 key 长度不能太长
key 太长会导致一个页当中能够存放的 key 的数目变少，间接导致索引树的页数目变多，索引层次增加，从而影响整体查询变更的效率。

#### 数据恢复
1. MySQL的数据如何恢复到任意时间点？
恢复到任意时间点以定时的做全量备份，以及备份增量的 binlog 日志为前提。恢复到任意时间点首先将全量备份恢复之后，再此基础上回放增加的 binlog 直至指定的时间点。

## Redis

## Nginx

## 集群
**现有一批邮件需要发送给订阅顾客，且有一个集群（集群的节点数不定，会动态扩容缩容）来负责具体的邮件发送任务，如何让系统尽快地完成发送？**
1. 借助消息中间件，通过发布者订阅者模式来进行任务分配
1. master-slave 部署，由 master 来分配任务
1. 不借助任何中间件，且所有节点均等。通过数据库的 update-returning，从而实现节点之间任务的互斥

**有一批气象观测站，现需要获取这些站点的观测数据，并存储到 Hive 中。但是气象局只提供了 api 查询，每次只能查询单个观测点。那么如果能够方便快速地获取到所有的观测点的数据？**
1. 通过 shell 或 python 等调用 api，结果先暂存本地，最后将本地文件上传到 Hive 中。
1. 通过 datax 的 httpReader 和 hdfsWriter 插件，从而获取所需的数据。
1. 比较理想的回答，是在计算引擎的 UDF 中调用查询 api，执行UDF 的查询结果存储到对应的表中。一方面，不需要同步任务的导出导入；另一方面，计算引擎的分布式框架天生提供了分布式、容错、并发等特性。


## 设计模式

## 算法
#### 编程题
1. 已知sqrt(2)约等于1.414，要求不用数学库，求sqrt(2)精确到小数点后10位
[参考](https://github.com/0voice/interview_internal_reference/blob/master/01.%E9%98%BF%E9%87%8C%E7%AF%87/1.1.2%20%E5%B7%B2%E7%9F%A5sqrt%282%29%E7%BA%A6%E7%AD%89%E4%BA%8E1.414%EF%BC%8C%E8%A6%81%E6%B1%82%E4%B8%8D%E7%94%A8%E6%95%B0%E5%AD%A6%E5%BA%93%EF%BC%8C%E6%B1%82sqrt%282%29%E7%B2%BE%E7%A1%AE%E5%88%B0%E5%B0%8F%E6%95%B0%E7%82%B9%E5%90%8E10%E4%BD%8D.md)

**如何实现两金额数据相加（最多小数点两位）？**
1. 整数存储。比如1.23元，用123存储。
1. 字符串存储。比如1.23元，用"123.00"存储。
1. 高精度浮点数存储。比如 `BigDecimal`。


## 数据结构

#### 编程题
1. 如何实现一个高效的单向链表逆序输出？
[参考](https://github.com/0voice/interview_internal_reference/blob/master/01.%E9%98%BF%E9%87%8C%E7%AF%87/1.1.1%20%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%AB%98%E6%95%88%E7%9A%84%E5%8D%95%E5%90%91%E9%93%BE%E8%A1%A8%E9%80%86%E5%BA%8F%E8%BE%93%E5%87%BA%EF%BC%9F.md)

1. 给定一个二叉搜索树(BST)，找到树中第 K 小的节点。
[here](https://github.com/0voice/interview_internal_reference/blob/master/01.%E9%98%BF%E9%87%8C%E7%AF%87/1.1.3%20%E7%BB%99%E5%AE%9A%E4%B8%80%E4%B8%AA%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%28BST%29%EF%BC%8C%E6%89%BE%E5%88%B0%E6%A0%91%E4%B8%AD%E7%AC%AC%20K%20%E5%B0%8F%E7%9A%84%E8%8A%82%E7%82%B9.md)

1. 设计一个LRU缓存机制
[here](https://github.com/0voice/interview_internal_reference/blob/master/01.%E9%98%BF%E9%87%8C%E7%AF%87/1.1.4%20LRU%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6.md)

## 架构设计
**常见的高并发场景有哪些，对应的架构设计方案是什么**
高并发是一种系统运行过程中遇到的一种“短时间内遇到大量操作请求”的情况，主要发生在 Web 系统集中大量访问收到大量请求。该情况的发生会导致系统在这段时间内执行大量操作，例如对资源的请求，数据库的操作等。

常见的高并发场景：
1. 天猫双十一活动
1. 12306的抢票情况
1. 明星婚恋话题引爆微博热搜

高并发的处理指标：
1. 响应时间
   系统对请求做出响应的时间。例如系统处理一个HTTP请求需要200ms，这个200ms就是系统的响应时间。
1. 吞吐量
   单位时间内处理的请求数量。
1. QPS
   每秒响应请求数。在互联网领域，这个指标和吞吐量区分的没有这么明显。
1. 并发用户数
   同时承载正常使用系统功能的用户数量。例如一个即时通讯系统，同时在线量一定程度上代表了系统的并发用户数。

结构设计方案：参考下面。

**介绍完整的分布式中间件有哪些，各自的应用场景和作用**
中间件是指和业务无关的技术类组件，它的作用是让业务和底层解耦、屏蔽底层复杂的逻辑，提供更简单的服务，让业务端的开发更简单。常见的有如下几种：服务中间件、集成中间件、数据中间件、消息中间件、安全中间件。

1. 服务中间件
   tomcat、dubbo、springcloud
1. 消息中间件
   消息系统的引入是为了解耦服务调用。消息发送的一致性是指产生消息的业务动作和消息发送一致。
   kafka、rocketMQ、rabbitMQ
1. 缓存中间件
   redis、memcache、es
1. 数据库中间件
   分库分表：当数据量大的时候，单台数据库已经不足以支撑我们的业务量，所以会采用分库分表的做法。这类组件有MyCat、MySQL-Proxy、360的Atlas、阿里的Cobar、淘宝的DRDS
   数据迁移：用于不同类型数据库的迁移，主要有阿里的yugong
   数据增量订阅和消费：用于对数据库增量日志解析，提供增量数据订阅和消费，主要有有阿里的canal。
1. 一致性中间件
   zookeeper、etcd

**双11秒杀活动，你的技术架构设计思路**
挑战：
1. 突增的服务器及网络需求
   通常情况下，双 11 的服务器使用是平时的 3-5 倍，网络带宽是平时 N倍。
1. 业务高并发，服务负载重
   在高并发的实际场景下，服务器处于高负载的状态，网络带宽被挤满，在这个时候平均响应时间会被大大增加。随着用户数量的增加，数据库连接进程增加，需要处理的上下文切换也越多，服务器造成负载压力越来越重。
1. 业务耦合度高，引起系统“雪崩”
   当系统上某个应用因为延迟而变得不可用，用户的点击越频繁，恶性循环最终导致“雪崩”，因为其中一台服务器挂了，导致流量分散到其他正常工作的机器上，再导致正常的机器也挂，然后恶性循环，将整个系统拖垮。

思路：
1. 限流
1. 削峰
1. 异步处理
1. 内存缓存
1. 可拓展

前端设计方案：
1. 单独的图片服务器
   使用单独的图片服务器，降低服务器压力，使其不会因为图片加载造成崩溃  
1. 页面静态化
   将活动页面上的所有可以静态的元素全部静态化，并尽量减少动态元素。通过CDN来抗峰值。
1. 禁止重复提交
   用户提交之后按钮置灰，禁止重复提交。

后端设计方案：
1. 用户限流
   在某一时间段内只允许用户提交一次请求，比如可以采取IP限流
   我们上面拦截了浏览器访问的请求，但针对某些恶意攻击或其它插件，在服务端控制层需要针对同一用户限制访问频率。
1. 采用消息队列缓存请求
   既然服务层知道库存只有100台手机，那完全没有必要把100W个请求都传递到数据库啊，那么可以先把这些请求都写到消息队列缓存一下，数据库层订阅消息减库存，减库存成功的请求返回秒杀成功，失败的返回秒杀结束。
1. 利用缓存应对读请求
   比如双11秒杀抢购，是典型的读多写少业务，大部分请求是查询请求，所以可以利用缓存分担数据库压力。
1. 利用缓存应对写请求
   缓存也是可以应对写请求的，比如我们就可以把数据库中的库存数据转移到Redis缓存中，所有减库存操作都在Redis中进行，然后再通过后台进程把Redis中的用户秒杀请求同步到数据库中。
1. 微服务
   一个工程被拆分为多个工程部署。
   
数据库设计方案：
1. SQL优化
1. 表结构优化
1. 存储引擎优化
1. 分库分表
1. 读写分离

总结：层层过滤、尽量将请求拦截在上游，降低下游的压力、 充分利用缓存与消息队列，提高请求处理速度以及削峰填谷的作用。