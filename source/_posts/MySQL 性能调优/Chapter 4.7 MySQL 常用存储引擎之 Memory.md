---
title: Chapter 4.7 MySQL 常用存储引擎之 Memory

categories:
- MySQL 性能调优

date: 2020-04-28 00:00:47
---
MEMORY 存储引擎是 MySQL 中的一种特殊的存储引擎。其使用存储在内存中的内容来创建表，而且所有数据也放在内存中。

## MEMORY 的文件格式
每个基于 MEMORY 存储引擎的表实际对应一个磁盘文件。改文件的文件名与表名相同，类型为 **.frm**。该文件中只存储表的结构，而其数据文件是存储在内存中。这样有利于对数据的快速处理，提高整个表的处理效率。值得注意的是，服务器需要有足够的内存来维持 MEMORY 存储引擎的表的使用。如果不需要使用了，可以释放这些内容，甚至可以删除不需要的表。

## MEMORY 的索引类型
MEMORY 存储引擎默认使用 HASH 索引，其速度要比使用 BTree 索引快。如果读者希望使用 BTree 索引，可以在创建索引时选择使用。

## MEMORY 的存储周期
MEMORY 存储引擎通常很少用到，因为 MEMORY 表的所有数据都是存储在内存上的，如果内存出现异常就会影响到数据的完整性。如果重启机器或者关机，表中所有数据将消失。因此，基于 MEMORY 存储引擎的表声明周期很短，一般都是一次性的。

## MEMORY 的优缺点
MEMORY 表的大小是受到限制的。表的大小主要取决于两个参数，分别是 **max rows** 和 **max_heap_size**。其中 **max_rows** 可以在创建表时指定；**max_heap_size** 的大小默认是 16MB，可以按需进行扩大。因此，其存在于内存中的特性，决定了这类表的处理速度非常快。但是，其数据易丢失，生命周期短。

创建 MySQL MEMORY 存储引擎的出发点是速度。为得到最快的相应时间，采用的逻辑存储介质是系统内存。虽然在内存中存储表数据确实会提高性能，但要记住，当 MySQL 守护进程奔溃时，所有的 MEMORY 数据都丢失。

MEMORY 表不支持 **VARCHAR**、**BLOB**、和 **TEXT** 数据类型，因为这种表类型按照固定长度的记录格式存储。此外，如果使用版本 4.1.0 之前的 MySQL，则不支持自动增加列（通过 AUTO_INCREMENT 属性）。当然，要记住 MEMORY 表只用于特殊的范围，不会用于长期存储数据。基于其这个缺陷，选择 MEMORY 存储引擎时要特别小心。

当数据有如下情况时，可以考虑使用 MEMORY 表。

1. 暂时：目标数据只是临时需要，在其生命周期中必需立即可用。

1. 相对无关：存储在 MEMORY 表中的数据如果突然丢失，不会对应用服务产生实质的负面影响，而且不会对数据完整性有长期影响。

如果使用 MySQL 4.1 及之前版本，MEMORY 的搜索比 MyISAM 表的搜索效率要低，因为 MEMORY 表只支持散列索引，这需要使用整个键进行搜索。但是，4.1 之后的版本同时支持散列索引和 BTree 索引。BTree 索引优于散列索引的是，可以部分查询和通配查询，也可以使用 **<**、**>** 和 **>=** 等操作符方便数据挖掘。