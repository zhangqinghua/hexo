---
title: 4.3 CachedThreadPool

categories:
- 多线程高并发编程

tags:
- Thread
- CachedThreadPool

date: 2020-02-03 15:00
---
CachedThreadPool是一个可以无限扩大的线程池，它有以下特点：
1. `corePoolSize`为0，`maximumPoolSize`为无限大，意味着线程数量可以无限大
1. `keepAliveTime`为60秒，意味着线程空闲时间超过60秒就会被杀死
1. 采用`SynchronousQueue`装载等待的任务，这个阻塞队列没有存储空间。这意味着只要有请求到来，就必须找到一个工作线程处理，如果当前没有空闲的线程，那么就创建一条新的线程

## 源码
```java
public static ExecutorService newCachedThreadPool(ThreadFactory threadFactory) {
    return new ThreadPoolExecutor(0, Integer.MAX_VALUE,
                                  60L, TimeUnit.SECONDS,
                                  new SynchronousQueue<Runnable>(),
                                  threadFactory);
}
```

## 实例
```java
public class CachedThreadPool {

    public static void main(String[] args) throws InterruptedException {
        // 1. 创建线程池
        ExecutorService service = Executors.newCachedThreadPool();
        System.out.println(service);

        // 2. 添加任务
        for (int i = 0; i < 2; i++) {
            service.execute(() -> {
                try {
                    TimeUnit.SECONDS.sleep(1L);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
                System.out.println(Thread.currentThread().getName());
            });
        }

        // 3. 查询线程池状态（一段时间后自动销毁空闲线程）
        System.out.println(service);
        TimeUnit.SECONDS.sleep(80);
        System.out.println(service);
    }
}

// java.util.concurrent.ThreadPoolExecutor@28a418fc[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]
// java.util.concurrent.ThreadPoolExecutor@28a418fc[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
// pool-1-thread-2
// pool-1-thread-1
// java.util.concurrent.ThreadPoolExecutor@28a418fc[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 2]
```